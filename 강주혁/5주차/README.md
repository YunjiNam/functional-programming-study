# 5주차 - 챕터 9. 계층형 설계 2

## 패턴 2: 추상화 벽
> 세부 구현을 감춘 함수로 이루어진 계층
> 데이터 구조를 전혀 몰라도 함수를 사용할 수 있음

추상화 벽 사용 
-> 마케팅 팀이 세부 구현 신경 안써도 됨
-> 개발 팀은 추상화 벽에 있는 함수를 사용하는 마케팅 관련 코드를 신경 안써도 됨

라이브러리나 API와 비슷함

추상화 벽 위에 있는 함수가 벽 아래 있는 함수를 사용하면 `완전하지 않은 추상화 벽`이라고 함
추상화 벽에 새로운 함수를 만들어서 `완전한 추상화 벽`으로 만들어야 함

### 언제 사용할까?
- 구현에 대한 확신이 없는 경우
  - 구현을 간접적으로 사용할 수 있어 나중에 구현 바꾸기 쉬움

- 코드를 읽고 쓰기 쉽게 만들기 위해
  - 세부적인 것을 신경 쓰지 않아 코드가 간결해짐

- 주어진 문제를 집중하기 위해
  - 해결하려는 문제의 구체적인 부분을 무시할 수 있어 집중하기 쉬움

### ⚠️ 주의할 점
코드를 쉽게 고치려고 추상화 벽을 사용하는 것은 아니다!
팀 간에 `커뮤니케이션 비용`을 줄이고, 복잡한 코드를 `명확하게` 하기 위해 전략적으로 사용하자.

## 패턴 3: 작은 인터페이스
> 추상화 벽에 있는 함수 = 인터페이스
> 인터페이스를 최소화하면 하위 계층에 불필요한 기능이 쓸데없이 커지는 것을 막을 수 있음

새로운 기능을 만들 때 하위 계층에 기능을 추가하거나 고치는 것보다 상위 계층에 만드는 것이 `작은 인터페이스 패턴`이다.

### 추상화 벽을 작게 만들어야하는 이유?
- 추상화 벽에 코드가 많을수록 구현 변경 시 고칠 게 많아짐
- 추상화 벽에 있는 코드는 낮은 수준의 코드라 더 많은 버그 있을 수 있음
- 낮은 수준의 코드는 이해하기 더 어려움
- 추상화 벽에 코드가 많을수록 팀 간 조율할 것도 많아짐
- 추상화 벽에 인터페이스가 많으면 알아야 할 것이 많아 사용하기 어려워짐

## 패턴 4: 편리한 계층
> 언제 패턴을 적용하고 언제 멈춰야 하는지 실용적인 방법을 알려줌
> 작업할 때 편리해야 함

과한 추상화를 하지 않도록 요구 사항에 맞게 패턴들을 적용해야 한다.

## 호출 그래프
### 구조
> 호출 그래프에 함수 이름을 빼고 함수 호출만 남기면 `구조에 대한 추상적인 모습`을 볼 수 있음
- 기능적 요구사항
  - 소프트웨어가 정확히 해야 하는 일
- 비기능적 요구사항
  - 테스트성: 어떤 것을 테스트하는 것이 가장 중요한가?
  - 재사용성: 어떤 함수가 재사용하기 좋은가?
  - 유지보수성: 요구사항이 바뀌었을 때 가장 쉽게 고칠 수 있는 코드는 무엇인가?

제일 고치기 쉬운 코드는 `호출 그래프의 가장 위에 있는 코드`이다.
아무 곳도 호출하는 곳이 없기 때문에 다른 코드에 영향을 주지 않고 고칠 수 있다.

반면에 `호출 그래프의 가장 아래에 있는 코드`는 다른 코드에 영향을 많이 주기 때문에 고치기 어렵다.

=> 시간이 지나도 변하지 않은 코드, 예를 들어 `카피-온-라이트` 함수 같은 것들은 가장 아래에 있어야 한다.

하위 계층의 코드들을 테스트할 시 얻는 것이 많다. 그리고 재사용하기 좋다.

- 유지보수성
  - 위로 연결된 것이 적은 함수가 바꾸기 쉬움
  - 자주 바뀌는 코드는 가능한 위쪽에 있어야 함

- 테스트 가능성
  - 위쪽으로 많이 연결된 함수를 테스트하는 것이 더 가치 있음
  - 아래쪽에 있는 함수를 테스트하는 것이 위쪽에 있는 함수를 테스트하는 것보다 가치 있음

- 재사용성
  - 아래쪽에 함수가 적을수록 더 재사용하기 좋음
  - 낮은 수준의 단계로 함수를 빼내면 재사용성이 더 높아짐

